name: WeasyPrint's tests
on: [push]

jobs:
    tests:
        name: ${{ matrix.os }} - ${{ matrix.python-version }}
        runs-on: ${{ matrix.os }}
        strategy:
            fail-fast: false
            matrix:
                os: [windows-latest]
                python-version: [3.8]

        steps:
            - uses: actions/checkout@v2
            - name: Install msys2
              if: matrix.os == 'windows-latest'
              run: |
                  choco install -y --no-progress msys2
                  powershell "C:\tools\msys64\usr\bin\bash -lc 'pacman -S mingw-w64-x86_64-ttf-dejavu mingw-w64-x86_64-gtk3 --noconfirm'"
                  $env:PATH += ";C:\tools\msys64\mingw64\bin;C:\tools\msys64\usr\bin"
                  echo "::set-env name=PATH::$env:PATH"
            - uses: actions/setup-python@v1
              with:
                  python-version: ${{ matrix.python-version }}
            - name: Build
              run: |
                  cp .github/download_binaries.py download_binaries.py
                  python download_binaries.py 64
                  tree /F /A build
            - name: Build
              with:
                  name: build-test
                  path: build
